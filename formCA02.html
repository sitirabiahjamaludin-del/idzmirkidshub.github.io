<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Customer Lead Capture Form</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:"Poppins", Arial, sans-serif; background-color:#f0f4f8; padding:20px; }
    .ca02-form-wrapper { position:relative; max-width:700px; margin:0 auto; padding:30px 40px; border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,0.1); color:#002060; background-color:#fff; overflow:hidden; }
    .ca02-form-wrapper::before { content:""; position:absolute; top:0; left:0; width:100%; height:100%; background:url('https://picsum.photos/seed/leadcapture/700/1000.jpg') center/cover no-repeat; opacity:0.08; pointer-events:none; z-index:0; }
    .ca02-form-wrapper > * { position:relative; z-index:1; }
    .ca02-form-wrapper h2 { text-align:center; color:#004aad; margin-bottom:20px; font-size:1.6rem; font-weight:600; }
    .ca02-form-wrapper label { display:block; margin-top:12px; font-weight:600; font-size:0.9rem; }
    .ca02-form-wrapper small { display:block; font-size:0.75rem; color:#666; margin:4px 0; }
    .ca02-form-wrapper input, .ca02-form-wrapper select, .ca02-form-wrapper textarea { width:100%; padding:10px; margin-top:4px; border:1px solid #ccc; border-radius:6px; font-size:0.9rem; font-family:"Poppins", Arial, sans-serif; background:#fff; transition:border-color 0.3s, box-shadow 0.3s; }
    .ca02-form-wrapper input:focus, .ca02-form-wrapper select:focus, .ca02-form-wrapper textarea:focus { border-color:#004aad; box-shadow:0 0 0 2px rgba(0,74,173,0.2); outline:none; }
    .ca02-form-wrapper textarea { min-height:80px; resize:vertical; }
    .ca02-gender-container { display:flex; gap:20px; margin:8px 0 20px 0; justify-content:flex-start; }
    .ca02-gender-option { display:flex; flex-direction:column; align-items:center; justify-content:center; background:transparent; padding:8px; border-radius:50%; transition:0.3s; width:90px; height:110px; opacity:0.8; cursor:pointer; }
    .ca02-gender-option:hover { opacity:1; transform:scale(1.05); }
    .ca02-gender-option span { display:block; width:100%; text-align:center; margin-top:8px; font-weight:bold; font-size:0.9rem; }
    .ca02-gender-option input { display:none; }
    .ca02-gender-img { width:70px; height:70px; object-fit:cover; border-radius:50%; border:3px solid transparent; transition: transform 0.3s ease, border 0.3s ease; }
    .ca02-gender-option input:checked + .ca02-gender-img { border:3px solid #004aad; transform:scale(1.05); }
    .ca02-btn { display:block; width:100%; margin-top:25px; padding:14px; background-color:#004aad; color:white; border:none; border-radius:8px; font-size:1rem; font-weight:600; cursor:pointer; font-family:"Poppins", Arial, sans-serif; transition:background-color 0.3s, transform 0.2s; }
    .ca02-btn:hover { background-color:#003080; }
    .ca02-btn:active { transform:scale(0.98); }
    .required:after { content:" *"; color:#e74c3c; }
    .error-message { color:#e74c3c; font-size:0.8rem; margin-top:4px; display:none; }
    .success-message { display:none; padding:15px; margin-top:20px; background-color:#d4edda; color:#155724; border-radius:8px; text-align:center; }
    .two-column, .name-columns, .age-calculator { display:grid; grid-template-columns:1fr 1fr; gap:15px; }
    @media (max-width:600px) { .ca02-form-wrapper { padding:20px; } .two-column, .name-columns, .age-calculator { grid-template-columns:1fr; } }
    .form-navigation { display:flex; justify-content:space-between; margin-top:20px; flex-wrap:wrap; gap:10px; }
    .nav-btn, #btnBack { padding:10px 20px; background-color:#004aad; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:600; transition:background-color 0.3s; }
    .nav-btn:hover, #btnBack:hover { background-color:#003080; }
    .nav-btn.secondary { background-color:#ccc; color:#666; }
    .nav-btn.secondary:hover { background-color:#bbb; }
  </style>
</head>
<body>
<div class="ca02-form-wrapper">
  <h2>CUSTOMER LEAD CAPTURE FORM</h2>

  <form id="formCA02">

    <!-- ALL INPUTS IN ONE PAGE -->
    <h3>BASIC LEAD INFORMATION</h3>
    <label for="DateInquiry" class="required">Date Inquiry</label>
    <input type="date" id="DateInquiry" name="DateInquiry" required>
    <div class="error-message" id="DateInquiry-error">Please enter the inquiry date</div>

    <label for="TimeInquiry" class="required">Time Inquiry</label>
    <small>Please use 24-hour format Eg:09:30, 15:00</small>
    <input type="time" id="TimeInquiry" name="TimeInquiry" required>
    <div class="error-message" id="TimeInquiry-error">Please enter the inquiry time</div>

    <label for="MarketingCode" class="required">Marketing Code</label>
    <input type="text" id="MarketingCode" name="MarketingCode" placeholder="Enter marketing code" required>
    <div class="error-message" id="MarketingCode-error">Please enter the marketing code</div>

    <label for="SourceOfLead" class="required">Source of Lead</label>
    <select id="SourceOfLead" name="SourceOfLead" required>
      <option value="">-- Please choose --</option>
      <option value="Call">Call</option>
      <option value="Facebook">Facebook</option>
      <option value="Instagram">Instagram</option>
      <option value="Walk In">Walk In</option>
      <option value="Referral">Referral</option>
      <option value="Friends and Family">Friends and Family</option>
      <option value="Website">Website</option>
      <option value="WhatsApp">WhatsApp</option>
      <option value="Event Booth">Event Booth</option>
    </select>
    <div class="error-message" id="SourceOfLead-error">Please select a source of lead</div>

    <label for="CapturedBy" class="required">Captured By</label>
    <select id="CapturedBy" name="CapturedBy" required>
      <option value="">-- Please choose --</option>
      <option value="Siti Nur Afiqah binti Basiran">Siti Nur Afiqah binti Basiran</option>
      <option value="Nurlizah binti Khazani">Nurlizah binti Khazani</option>
      <option value="Nur Dalila binti Kamilan">Nur Dalila binti Kamilan</option>
      <option value="Ricxstalonce Sating">Ricxstalonce Sating</option>
      <option value="Halimah binti Hadi">Halimah binti Hadi</option>
    </select>
    <div class="error-message" id="CapturedBy-error">Please select who captured the lead</div>

    <label for="LeadCategory" class="required">Lead Category</label>
    <select id="LeadCategory" name="LeadCategory" required>
      <option value="">-- Please choose --</option>
      <option value="New">New</option>
      <option value="Retruning">Retruning</option>
      <option value="Referral">Referral</option>
      <option value="Corporate Inquiry">Corporate Inquiry</option>
    </select>
    <div class="error-message" id="LeadCategory-error">Please select a lead category</div>

    <label for="ReferralFullName">Referral Name (if applicable)</label>
    <input type="text" id="ReferralFullName" name="ReferralFullName" placeholder="Full name + type (if Referral)">

    <!-- Add rest of all sections here in same style -->
    <!-- Parent, Child, Inquiry, Follow-up, Review -->

    <!-- Navigation Buttons -->
    <div class="form-navigation">
      <button id="btnBack" type="button">Back to Department</button>
      <button type="submit" class="ca02-btn">Submit</button>
    </div>

    <!-- Success Message -->
    <div class="success-message" id="success-message">
      Thank you! Your lead capture form has been submitted successfully.
    </div>
  </form>
</div>

<script>
document.getElementById('btnBack').addEventListener('click', () => {
  window.location.href = '../../Department/department.html';
});

// Populate country list
const countries = ["Malaysia", "Singapore", "Indonesia", "Thailand"]; // shortened for brevity
const countrySelect = document.getElementById("Country");
const citizenshipSelect = document.getElementById("ChildCitizenship");
if(countrySelect && citizenshipSelect){
  countries.forEach(country=>{
    const option1 = document.createElement("option"); option1.value = country; option1.textContent = country; countrySelect.appendChild(option1);
    const option2 = document.createElement("option"); option2.value = country; option2.textContent = country; citizenshipSelect.appendChild(option2);
  });
  countrySelect.value = "Malaysia"; citizenshipSelect.value = "Malaysia";
}

// Default dates
const today = new Date().toISOString().split('T')[0];
document.getElementById('DateInquiry').value = today;
document.getElementById('DateReview').value = today;

// Show/hide Other Diagnosis
document.getElementById('Diagnosis')?.addEventListener('change', function(){
  const otherDiagnosisField = document.getElementById('OtherDiagnosis');
  if(this.value === 'Other'){ otherDiagnosisField.style.display='block'; otherDiagnosisField.required=true; }
  else { otherDiagnosisField.style.display='none'; otherDiagnosisField.required=false; }
});

// Age calculation
document.getElementById('DateOfBirth')?.addEventListener('change', function(){
  const birthDate = new Date(this.value);
  const todayDate = new Date();
  let years = todayDate.getFullYear() - birthDate.getFullYear();
  let months = todayDate.getMonth() - birthDate.getMonth();
  if(months < 0){ years--; months+=12; }
  if(todayDate.getDate()<birthDate.getDate()){ months--; if(months<0){ years--; months=11; } }
  document.getElementById('ChildAgeYears').value = years;
  document.getElementById('ChildAgeMonths').value = months;
});

// Form submission
const form = document.getElementById('formCA02');
form.addEventListener('submit', async function(e){
    e.preventDefault();
    let isValid = true;
    form.querySelectorAll('[required]').forEach(field=>{
        const errorEl = document.getElementById(field.id+'-error');
        if(!field.value.trim()){
            isValid=false;
            if(errorEl) errorEl.style.display='block';
        } else if(errorEl) errorEl.style.display='none';
    });
    if(!isValid) return;

    // Ambil semua form data
    const formData = {};
    form.querySelectorAll('input, select, textarea').forEach(el=>{
        formData[el.name] = el.value;
    });

    try {
        const res = await fetch('http://localhost:5000/api/formca02', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
        });

        const data = await res.json();
        if(res.ok){
            document.getElementById('success-message').textContent = data.message;
            document.getElementById('success-message').style.display='block';
            form.reset();
        } else {
            alert(data.message || 'Something went wrong');
        }
    } catch(err){
        console.error(err);
        alert('Failed to submit form');
    }
});
</script>
</body>
</html>
